---
title: ztreeçš„è‡ªå®šä¹‰ç¼–è¾‘
date: 2018-08-29 11:10:04
categories:
- ç»„ä»¶æ•´ç†
tags:
- ztree
---
ç»„ç»‡æ¶æ„æ ‘æ˜¯é¡¹ç›®ä¸­ç‰¹åˆ«å¸¸è§çš„ä¸€ç±»ç»„ä»¶ï¼Œæˆ‘ä¸€èˆ¬éƒ½ç”¨[ztree](http://www.ztree.me/)ï¼Œå‰ä¸¤å¤©åˆç”¨åˆ°è¿™ä¸ªï¼Œä¸è¿‡éœ€æ±‚è·Ÿå¹³æ—¶æœ‰ç‚¹åŒºåˆ«ï¼Œæˆ‘æ„Ÿè§‰ä¹Ÿç®—æ¯”è¾ƒå¸¸è§ï¼Œå°±æŠŠä»–ç¨å¾®æ•´ç†ä¸€ä¸‹ã€‚

éœ€æ±‚å¤§è‡´æ˜¯è¿™æ ·ï¼šä¸€ä¸ªæ™®é€šçš„æ ‘ç»“æ„ï¼Œç‚¹å‡»ç¼–è¾‘ã€‚
![](http://res.troubledot.cn/edit.png)

ä¼šå¼¹å‡ºæ¥æ“ä½œæŒ‰é’®ï¼Œè€Œä¸”å¹¶ä¸æ˜¯æ‰€æœ‰ç”¨æˆ·éƒ½æœ‰å¢åˆ æ”¹çš„æƒé™ï¼Œå¯¹è¯¥èŠ‚ç‚¹ä¸å…·å¤‡çš„æƒé™ä¼šç½®ç°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![](http://res.troubledot.cn/WX20180830-122042@2x.png)

æˆ‘ä»¬çŸ¥é“ztreeæ˜¯å¸¦ç¼–è¾‘åŠŸèƒ½çš„ï¼Œä½†æ˜¯é•¿è¿™æ ·å­

![](http://res.troubledot.cn/ztree.png)

è€Œä¸”ztreeçš„å®˜æ–¹demoçš„ç¼–è¾‘æŒ‰é’®æ˜¯åœ¨é¼ æ ‡hoveråˆ°èŠ‚ç‚¹ä»¥åæ‰å¼¹å‡ºæ¥çš„ï¼Œæ˜¾ç„¶è·Ÿæˆ‘ä»¬çš„éœ€æ±‚ä¸ç¬¦åˆã€‚æˆ‘çœ‹äº†ä¸‹ä»£ç ï¼Œå‘ç°åˆ é™¤å’Œç¼–è¾‘ç”¨çš„æ˜¯è¿™ä¸¤ä¸ªAPI

```javascript 
 editName(node)    //å‚æ•°ä¸ºè¦æ“ä½œçš„èŠ‚ç‚¹
 removeNode (node, callbackFlag) //å‚æ•°ä¸ºè¦æ“ä½œçš„èŠ‚ç‚¹ 
```

é¼ æ ‡çš„hoverå…¶å®ä¸æ˜¯ä¼ªç±»:hover,è€Œæ˜¯è°ƒç”¨äº† addHoverDom å’Œ removeHoverDomè¿™ä¸¤ä¸ªAPIï¼Œç›®çš„æ˜¯æ‹¿åˆ°è¦æ“ä½œçš„èŠ‚ç‚¹ã€‚å†çœ‹æˆ‘ä»¬çš„éœ€æ±‚ï¼Œå‘ç°æˆ‘ä»¬éœ€è¦æ‰€æœ‰çš„èŠ‚ç‚¹ï¼ˆztreeå¯¹è±¡çš„getNodes()æ–¹æ³•å¯ä»¥æ‹¿åˆ°æ‰€æœ‰èŠ‚ç‚¹ï¼‰ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦è®©æ¯ä¸ªèŠ‚ç‚¹çš„æ“ä½œæŒ‰é’®éƒ½æ˜¾ç¤ºå‡ºæ¥ã€‚
åŸºæœ¬æ€è·¯ï¼šéå†æ‰€æœ‰èŠ‚ç‚¹ï¼Œç„¶åæ“ä½œè¯¥èŠ‚ç‚¹å¯¹åº”çš„domï¼Œæ‹¼æ¥æ“ä½œæŒ‰é’®å›¾æ ‡ï¼ˆè¿™é‡Œéœ€è¦åˆ¤æ–­æ˜¯å¦æœ‰æƒé™ï¼Œæ ¹æ®æƒé™æ‹¼æ¥ä¸åŒçš„å›¾æ ‡ï¼‰ï¼Œå†ç»™æŒ‰é’®ç»‘å®šäº‹ä»¶ï¼Œè°ƒç”¨å¯¹åº”æ“ä½œçš„APIï¼›

 ä»£ç å¦‚ä¸‹ï¼Œå› ä¸ºè¿˜æœ‰åœ°æ–¹è¦è°ƒç”¨ï¼Œæ‰€ä»¥æˆ‘å°†å…¶å°è£…æˆäº†æ–¹æ³•
 
 ```javascript
 function addnewBtn(nodeList) {
    var newCount = 1;
    var zTree = $.fn.zTree.getZTreeObj("tree");
    nodeList.forEach(function(element, index) {
        var sObj = $("#" + element.tId + "_span");
        if (zTree.setting.edit.enable) {     //åˆ¤æ–­å½“å‰æ˜¯å¦å¯ä»¥ç¼–è¾‘
            var addable = (element.addable == undefined) || (element.addable == true) ? "addable" : ""; //æ–°å¢æƒé™ æƒé™å¢åŠ äº†ä¸€ä¸ªableçš„æ ‡è®°ï¼Œæ ¹æ®classå–ä¸åŒå›¾ç‰‡ï¼Œä¸‹é¢ç»‘å®šäº‹ä»¶ä¹Ÿæ˜¯ç»‘åœ¨è¯¥classä¸Š ä¸‹åŒ
            var editable = (element.editable == undefined) || (element.editable == true) ? "editable" : "";   //ç¼–è¾‘æƒé™
            var removeable = (element.removeable == undefined) || (element.removeable == true) ? "removeable" : "";  //åˆ é™¤æƒé™
            if (element.editNameFlag || $("#addBtn_" + element.tId).length > 0 || $("#remove_" + element.tId).length > 0 || $("#edit_" + element.tId).length > 0) return;  //æœ‰æŒ‰é’®å°±ä¸å†åŠ äº†
            var addStr = "<span class='button add " + addable + "' id='addBtn_" + element.tId +
                "' title='add node' onfocus='this.blur();'></span>"; //æ·»åŠ æŒ‰é’®
            var editStr = "<span class='button edit " + editable + "' id='edit_" + element.tId +"' title='rename' onfocus='this.blur();'></span>"; //ç¼–è¾‘æŒ‰é’®
            var delStr = "<span class='button remove " + removeable + "' id='remove_" + element.tId + "' title='remove' onfocus='this.blur();'></span>"; //åˆ é™¤æŒ‰é’®

            function allstr() {
                var allstr;
                if (element.isParent) {
                    allstr = addStr + editStr + delStr;
                } else {
                    allstr = editStr + delStr;
                }
                return allstr;
            }   // å­èŠ‚ç‚¹ä¸éœ€è¦æ–°å¢æŒ‰é’®
            sObj.after(allstr()); //æ‹¼æ¥html
            if ((element.addable == undefined) || (element.addable == true)) {
                var btn = $("#addBtn_" + element.tId);  //å–åˆ°æœ‰æƒé™çš„æ·»åŠ æŒ‰é’®
            }
            if (btn) btn.bind("click", function() {  //ç»™æ·»åŠ æŒ‰é’®ç»‘å®šäº‹ä»¶
                var newnode = zTree.addNodes(element, { id: (100 + newCount), pId: element.id, name: "new node" + (newCount++), isParent: true }, true); //æ–°å¢æ–‡ä»¶å¤¹ï¼ˆé»˜è®¤æ–°å¢çš„æ˜¯æ–‡ä»¶ éœ€æ±‚æœ‰ç‚¹æ€ªğŸ˜‚ï¼‰
                var tId = newnode[0].tId; //æ·»åŠ çš„èŠ‚ç‚¹  è·å–è¿™ä¸ªæ˜¯å› ä¸ºæ·»åŠ çš„æ˜¯æ–‡ä»¶å¤¹ æ‰€ä»¥ä»–è¿˜èƒ½ç»§ç»­æ·»åŠ 
                var nStr = "<span class='button add addable' id='addBtn_" + tId + "' title='add node' onfocus='this.blur();'></span><span class='button edit editable' id='edit_" + tId + "' title='rename' onfocus='this.blur();'></span><span class='button remove removeable' id='remove_" + tId + "' title='remove' onfocus='this.blur();'></span>"; 

                var nobj = $("#" + tId + "_span").after(nStr); //ç»™æ·»åŠ çš„èŠ‚ç‚¹åé¢åŠ æ“ä½œæŒ‰é’®
                var nbtn = $("#addBtn_" + tId);
                nbtn.bind('click', function() {  //ç»™æ·»åŠ çš„èŠ‚ç‚¹ä¸Šçš„æ·»åŠ æŒ‰é’®ç»‘å®šäº‹ä»¶
                    /* Act on the event */
                    zTree.addNodes(newnode[0], { id: (1000 + newCount), pId: newnode[0].id, name: "new node" + (newCount++), isParent: true }, true);
                });
                return false;
            });
        } else {
            return
        }
    });
}

 ```
è¿™é‡Œæˆ‘ä»¬å‘ç°å¢å’Œåˆ ã€æ”¹æ˜¯æœ‰åŒºåˆ«çš„ã€‚ å…¶å®æ¯”è¾ƒå¥½ç†è§£ï¼Œåˆ å’Œæ”¹æˆ‘ä»¬åªéœ€è¦çŸ¥é“æ“ä½œçš„å¯¹è±¡å°±å¯ä»¥äº†ï¼Œä½†æ˜¯æ·»åŠ çš„æ—¶å€™æˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“æ·»åŠ çš„å†…å®¹ã€‚  

è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œå’±ä»¬æ·»åŠ çš„è¿™å‡ ä¸ªæ“ä½œæŒ‰é’®åªå¯¹å±•å¼€çš„èŠ‚ç‚¹æœ‰ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬ç‚¹å‡»ç¼–è¾‘ä»¥åï¼Œå±•å¼€é‚£äº›ä¸€å¼€å§‹æ²¡æœ‰å±•å¼€çš„èŠ‚ç‚¹ï¼Œå‘ç°ä»–ä»¬çš„å­èŠ‚ç‚¹æ˜¯æ²¡æœ‰æ“ä½œæŒ‰é’®çš„ï¼Œæ˜¾ç„¶è¿™æ˜¯ä¸ç¬¦åˆæˆ‘ä»¬éœ€æ±‚çš„ã€‚æœ€ç®€å•çš„åŠæ³•ï¼Œç”¨èŠ‚ç‚¹å±•å¼€çš„å›è°ƒå‡½æ•°onExpandï¼Œå±•å¼€èŠ‚ç‚¹çš„æ—¶å€™ç»™ä»–æ‰€æœ‰çš„å­èŠ‚ç‚¹æ·»åŠ æŒ‰é’®ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘å°è£…addnewBtnçš„ä¸»è¦åŸå› 

```javascript
function zTreeOnExpand(event, treeId, treeNode) {
    function filter(node) {
        return node;
    }
    var treeObj = $.fn.zTree.getZTreeObj("tree");
    var nodes = treeObj.getNodesByFilter(filter,false,treeNode); // æŸ¥æ‰¾å­èŠ‚ç‚¹é›†åˆ
    addnewBtn(nodes);
};
```
ä¸‹é¢å°±å‰©ä¸‹ç¼–è¾‘å’Œåˆ é™¤äº†ï¼Œæˆ‘ä»¬å‰é¢åªæ˜¯æ‹¼äº†ä¸ªæŒ‰é’®ä¸Šå»ï¼Œå¹¶æ²¡æœ‰åšåŠŸèƒ½ï¼Œä»£ç å¦‚ä¸‹

```javascript
	
    var operateNode;  //å®šä¹‰ä¸€ä¸ªå˜é‡å­˜å½“å‰æ“ä½œçš„èŠ‚ç‚¹
    function zTreeOnClick(event, treeId, treeNode) {
        operateNode = treeNode;  //è·å–å½“å‰æ“ä½œçš„èŠ‚ç‚¹å­˜å…¥ operateNode
    };
    
    $(document).on('click', '.button.edit.editable', function(event) {  //äº‹ä»¶ç»‘å®šåˆ°editable ä¸Šæ˜¯ä¸ºäº†åŒºåˆ†æƒé™ ä¸‹åŒ
        var treeObj = $.fn.zTree.getZTreeObj("tree");
        treeObj.editName(operateNode);    // ç¼–è¾‘èŠ‚ç‚¹
    });
   
    $(document).on('click', '.button.remove.removeable', function(event) {
        var treeObj = $.fn.zTree.getZTreeObj("tree");
        treeObj.removeNode(operateNode);   // åˆ é™¤èŠ‚ç‚¹
    });
```

è¿™é‡Œåªæ˜¯éƒ¨åˆ†ä»£ç ï¼Œ[å®Œæ•´çš„ä»£ç åœ¨è¿™é‡Œ](https://github.com/Troubledot/Common-components)ï¼Œè‡ªå·±æ•´ç†çš„å¾ˆç®€å•çš„ä¸œè¥¿ï¼Œå¦‚æœè¿æ°”å¥½èƒ½å¸®åˆ°åˆ«äººï¼Œé‚£å°±å¤ªæ£’äº†ã€‚

 

